var touchpad_default=`<div id='pointer-capture'>
    <style>
        :host {
            display: block;
            width: 300px;
            height: 150px;
            user-select: none;
        }

        #pointer-capture {
            width: 100%;
            height: 100%;
        }
    </style>
    <slot></slot>
</div>`;var stopImmediatePropagation=(event)=>event.stopImmediatePropagation(),constrainDeadzone=(touchpadData,analogData)=>{let controlRadius=touchpadData.controlRadius,dx=analogData.controlX-analogData.deadzoneX,dy=analogData.controlY-analogData.deadzoneY,distance=Math.hypot(dx,dy);if(distance>controlRadius){let scale=(distance-controlRadius)/distance;analogData.deadzoneX+=dx*scale,analogData.deadzoneY+=dy*scale}},pointerdownListener=function(event){let touchpadData=this.touchpadData;if(touchpadData.pointerCaptureTarget.setPointerCapture(event.pointerId),touchpadData.analogMap.size<touchpadData.analogMax){let{x,y}=touchpadData.touchpad.getBoundingClientRect(),analogData={pointerId:event.pointerId,deadzoneX:event.clientX-x,deadzoneY:event.clientY-y,controlX:event.clientX-x,controlY:event.clientY-y,analogX:0,analogY:0};touchpadData.analogMap.set(event.pointerId,analogData),constrainDeadzone(touchpadData,analogData)}event.preventDefault()},pointermoveListener=function(event){let touchpadData=this.touchpadData;if(touchpadData.analogMap.size===0)return;let analogData=touchpadData.analogMap.get(event.pointerId);if(!analogData)return;let{x,y}=touchpadData.touchpad.getBoundingClientRect(),{deadzoneRadius,controlRadius}=touchpadData,dx=analogData.controlX-event.clientX+x,dy=analogData.controlY-event.clientY+y,distance=Math.hypot(dx,dy);if(distance>controlRadius+deadzoneRadius){let scale=(distance-controlRadius-deadzoneRadius)/distance;analogData.controlX-=scale*dx,analogData.controlY-=scale*dy}if(dx=analogData.deadzoneX-event.clientX+x,dy=analogData.deadzoneY-event.clientY+y,distance=Math.hypot(dx,dy),distance>deadzoneRadius){let scale=(distance-deadzoneRadius)/distance;analogData.deadzoneX-=dx*scale,analogData.deadzoneY-=dy*scale,constrainDeadzone(touchpadData,analogData)}analogData.analogX=(analogData.deadzoneX-analogData.controlX)/controlRadius,analogData.analogY=(analogData.deadzoneY-analogData.controlY)/controlRadius,analogData.analogX=Math.round(analogData.analogX*100)/100,analogData.analogY=Math.round(analogData.analogY*100)/100,event.preventDefault()},pointerupListener=function(event){this.touchpadData.pointerCaptureTarget.releasePointerCapture(event.pointerId),this.touchpadData.analogMap.delete(event.pointerId)},clickListener=function(event){if(!this.touchpadData.isClicking){this.touchpadData.isClicking=!0,this.touchpadData.clickCount++,clearTimeout(this.touchpadData.doubleClickTimeoutId),this.touchpadData.doubleClickTimeoutId=setTimeout(()=>{this.touchpadData.clickCount=0},this.touchpadData.doubleClickTime);let{pointerId,pointerType,button,buttons,screenX,screenY,clientX,clientY,width,height}=event;if(this.touchpadData.touchpad.dispatchEvent(new PointerEvent("click",{bubbles:!0,pointerId,pointerType,button,buttons,detail:this.touchpadData.clickCount,screenX,screenY,clientX,clientY,width,height})),(this.touchpadData.clickCount^1)===this.touchpadData.clickCount+1)this.touchpadData.touchpad.dispatchEvent(new PointerEvent("dblclick",{bubbles:!0,pointerId,pointerType,button,buttons,detail:this.touchpadData.clickCount,screenX,screenY,clientX,clientY,width,height}));this.touchpadData.isClicking=!1,event.stopImmediatePropagation()}},dblclickListener=function(event){if(!this.touchpadData.isClicking)event.stopImmediatePropagation()},defaultDeadzoneRadius=8,defaultControlRadius=64,TouchpadMap=new WeakMap;class HTMLTouchpadElement extends HTMLElement{static observedAttributes=["doubleclicktime","deadzoneradius","controlradius","analogmax"];constructor(){super();let touchpadData={touchpad:this,pointerCaptureTarget:null,isClicking:!1,clickCount:0,doubleClickTime:500,doubleClickTimeoutId:NaN,deadzoneRadius:defaultDeadzoneRadius,controlRadius:defaultControlRadius,analogMax:0,analogMap:new Map};TouchpadMap.set(this,touchpadData),this.addEventListener("pointerdown",{touchpadData,handleEvent:pointerdownListener},!0),this.addEventListener("touchstart",stopImmediatePropagation),this.addEventListener("mousedown",stopImmediatePropagation),this.addEventListener("pointermove",{touchpadData,handleEvent:pointermoveListener},!0),this.addEventListener("touchmove",stopImmediatePropagation),this.addEventListener("mousemove",stopImmediatePropagation),this.addEventListener("pointerup",{touchpadData,handleEvent:pointerupListener},!0),this.addEventListener("touchend",stopImmediatePropagation),this.addEventListener("mouseup",stopImmediatePropagation),this.addEventListener("click",{touchpadData,handleEvent:clickListener},!0),this.addEventListener("dblclick",{touchpadData,handleEvent:dblclickListener},!0)}get doubleclicktime(){return TouchpadMap.get(this).doubleClickTime}set doubleclicktime(time){this.setAttribute("doubleclicktime",time)}get deadzoneradius(){return TouchpadMap.get(this).deadzoneRadius}set deadzoneradius(radius){this.setAttribute("deadzoneradius",radius)}get controlradius(){return TouchpadMap.get(this).controlRadius}set controlradius(radius){this.setAttribute("controlradius",radius)}get analogmax(){return TouchpadMap.get(this).analogMax}set analogmax(max){this.setAttribute("analogmax",max)}getAnalogData(pointerId){return TouchpadMap.get(this).analogMap.get(pointerId)||null}attributeChangedCallback(name,_,newValue){switch(name){case"doubleclicktime":{let time=Math.round(Number(newValue));if(time<100)time=100;TouchpadMap.get(this).doubleClickTime=time;break}case"deadzoneradius":{let radius=Math.round(Number(newValue));if(radius<1)radius=1;TouchpadMap.get(this).deadzoneRadius=radius;break}case"controlradius":{let radius=Math.round(Number(newValue));if(radius<1)radius=1;TouchpadMap.get(this).controlRadius=radius;break}case"analogmax":{let touchpadData=TouchpadMap.get(this),pointerIds=touchpadData.analogMap.keys();if(touchpadData.analogMax=Number(newValue),touchpadData.analogMax<1){touchpadData.analogMap.clear();return}let i=0;for(let id of pointerIds){if(i>touchpadData.analogMax)touchpadData.analogMap.delete(id);i++}break}}}connectedCallback(){let root=this.attachShadow({mode:"closed"});root.innerHTML=`${touchpad_default}`,TouchpadMap.get(this).pointerCaptureTarget=root.querySelector("#pointer-capture")}}customElements.define("touchpad-component",HTMLTouchpadElement);export{HTMLTouchpadElement};
