var touchpad_default=`<div id='pointer-capture'></div>
<style>
    :host {
        display: block;
        width: 300px;
        height: 150px;
        user-select: none;
    }

    #pointer-capture {
        display: none;
    }
</style>
<slot></slot>`;var defaultListener=function(event){if(this.touchpadData.touchpad.hasAttribute("disable"))return;event.preventDefault(),event.stopImmediatePropagation()},pointerenterListener=function(event){let touchpadData=this.touchpadData;if(event.target!==touchpadData.touchpad||touchpadData.touchpad.hasAttribute("disable"))return;let{clientX,clientY,pointerId}=event;touchpadData.pointerMap.set(pointerId,{x:clientX,y:clientY,movementX:0,movementY:0,deadzoneX:clientX,deadzoneY:clientY,controlX:clientX,controlY:clientY,analogX:0,analogY:0,clickData:{0:{downX:NaN,downY:NaN,pressed:!1,clicks:0,clickTimeoutId:-1,doubleClickTimeoutId:-1},1:{downX:NaN,downY:NaN,pressed:!1,clicks:0,clickTimeoutId:-1,doubleClickTimeoutId:-1},2:{downX:NaN,downY:NaN,pressed:!1,clicks:0,clickTimeoutId:-1,doubleClickTimeoutId:-1},3:{downX:NaN,downY:NaN,pressed:!1,clicks:0,clickTimeoutId:-1,doubleClickTimeoutId:-1},4:{downX:NaN,downY:NaN,pressed:!1,clicks:0,clickTimeoutId:-1,doubleClickTimeoutId:-1}}}),event.preventDefault()},resetClick=(buttonData)=>{buttonData.downX=NaN,buttonData.downY=NaN,buttonData.clickTimeoutId=-1},pointerdownListener=function(event){let touchpadData=this.touchpadData;if(touchpadData.touchpad.hasAttribute("disable"))return;let{button,clientX,clientY,pointerId}=event,pointerData=touchpadData.pointerMap.get(pointerId);pointerData.x=pointerData.controlX=pointerData.deadzoneX=clientX,pointerData.y=pointerData.controlY=pointerData.deadzoneY=clientY;let clickData=pointerData.clickData;clickData[button].downX=clientX,clickData[button].downY=clientY,clickData[button].pressed=!0,clickData[button].clickTimeoutId=setTimeout(resetClick,touchpadData.clickTime,clickData[button]),touchpadData.pointerCaptureTarget.setPointerCapture(pointerId),event.preventDefault()},constrainDeadzone=(touchpadData,pointerData)=>{let controlRadius=touchpadData.controlRadius,dx=pointerData.controlX-pointerData.deadzoneX,dy=pointerData.controlY-pointerData.deadzoneY,distance=Math.hypot(dx,dy);if(distance>controlRadius){let scale=(distance-controlRadius)/distance;pointerData.deadzoneX+=dx*scale,pointerData.deadzoneY+=dy*scale}},pointermoveListener=function(event){let touchpadData=this.touchpadData;if(touchpadData.touchpad.hasAttribute("disable"))return;let{clientX,clientY,movementX,movementY,pointerId}=event,pointerData=touchpadData.pointerMap.get(pointerId);if(pointerData.x=clientX,pointerData.y=clientY,pointerData.movementX=movementX,pointerData.movementY=movementY,event.preventDefault(),!touchpadData.touchpad.hasAttribute("analog"))return;let{deadzoneRadius,controlRadius}=touchpadData,dx=pointerData.controlX-event.clientX,dy=pointerData.controlY-event.clientY,distance=Math.hypot(dx,dy);if(distance>controlRadius+deadzoneRadius){let scale=(distance-controlRadius-deadzoneRadius)/distance;pointerData.controlX-=scale*dx,pointerData.controlY-=scale*dy}if(dx=pointerData.deadzoneX-event.clientX,dy=pointerData.deadzoneY-event.clientY,distance=Math.hypot(dx,dy),distance>deadzoneRadius){let scale=(distance-deadzoneRadius)/distance;pointerData.deadzoneX-=dx*scale,pointerData.deadzoneY-=dy*scale,constrainDeadzone(touchpadData,pointerData)}pointerData.analogX=(pointerData.deadzoneX-pointerData.controlX)/controlRadius,pointerData.analogY=(pointerData.deadzoneY-pointerData.controlY)/controlRadius,pointerData.analogX=Math.round(pointerData.analogX*100)/100,pointerData.analogY=Math.round(pointerData.analogY*100)/100},resetDoubleClick=(buttonData)=>{buttonData.clicks=0,buttonData.doubleClickTimeoutId=-1},pointerupListener=function(event){let touchpadData=this.touchpadData;if(touchpadData.touchpad.hasAttribute("disable"))return;if(event.preventDefault(),this.touchpadData.inPointerUp)return;let{button,pointerId}=event,clickData=touchpadData.pointerMap.get(pointerId).clickData;if(clickData[button].pressed=!1,clickData[button].clickTimeoutId!==-1&&Math.hypot(event.clientX-clickData[button].downX,event.clientY-clickData[button].downY)<=this.touchpadData.clickDistance){clearTimeout(clickData[button].clickTimeoutId),clickData[button].clickTimeoutId=-1,event.stopImmediatePropagation(),touchpadData.inPointerUp=!0,touchpadData.touchpad.dispatchEvent(new PointerEvent("pointerup",event)),clickData[button].clicks++;let eventInit={...event,detail:clickData[button].clicks};if(touchpadData.touchpad.dispatchEvent(new PointerEvent("click",eventInit)),clickData[button].doubleClickTimeoutId!==-1)clearTimeout(clickData[button].doubleClickTimeoutId),clickData[button].doubleClickTimeoutId=-1,touchpadData.touchpad.dispatchEvent(new PointerEvent("dblclick",eventInit));else clickData[button].doubleClickTimeoutId=setTimeout(resetDoubleClick,touchpadData.doubleClickTime,clickData[button]);touchpadData.inPointerUp=!1}touchpadData.pointerCaptureTarget.releasePointerCapture(event.pointerId)},clickListener=function(event){if(this.touchpadData.touchpad.hasAttribute("disable"))return;if(event.preventDefault(),!this.touchpadData.inPointerUp)event.stopImmediatePropagation()},defaultDeadzoneRadius=8,defaultControlRadius=64,TouchpadMap=new WeakMap;class HTMLTouchpadElement extends HTMLElement{static observedAttributes=["doubleclicktime","deadzoneradius","controlradius","analogmax"];constructor(){super();let touchpadData={touchpad:this,pointerCaptureTarget:null,clickDistance:8,clickTime:500,doubleClickTime:500,inPointerUp:!1,deadzoneRadius:defaultDeadzoneRadius,controlRadius:defaultControlRadius,pointerMap:new Map};TouchpadMap.set(this,touchpadData);let listenerOptions={capture:!0,passive:!1};this.addEventListener("pointerenter",{touchpadData,handleEvent:pointerenterListener},listenerOptions),this.addEventListener("mouseenter",{touchpadData,handleEvent:defaultListener},listenerOptions),this.addEventListener("mouseover",{touchpadData,handleEvent:defaultListener},listenerOptions),this.addEventListener("pointerdown",{touchpadData,handleEvent:pointerdownListener},listenerOptions),this.addEventListener("touchstart",{touchpadData,handleEvent:defaultListener},listenerOptions),this.addEventListener("mousedown",{touchpadData,handleEvent:defaultListener},listenerOptions),this.addEventListener("pointermove",{touchpadData,handleEvent:pointermoveListener},listenerOptions),this.addEventListener("touchmove",{touchpadData,handleEvent:defaultListener},listenerOptions),this.addEventListener("mousemove",{touchpadData,handleEvent:defaultListener},listenerOptions),this.addEventListener("pointerup",{touchpadData,handleEvent:pointerupListener},listenerOptions),this.addEventListener("touchend",{touchpadData,handleEvent:defaultListener},listenerOptions),this.addEventListener("mouseup",{touchpadData,handleEvent:defaultListener},listenerOptions),this.addEventListener("click",{touchpadData,handleEvent:clickListener},listenerOptions),this.addEventListener("contextmenu",{touchpadData,handleEvent:defaultListener},listenerOptions),this.addEventListener("dblclick",{touchpadData,handleEvent:clickListener},listenerOptions),this.addEventListener("mouseout",{touchpadData,handleEvent:defaultListener},listenerOptions),this.addEventListener("mouseleave",{touchpadData,handleEvent:defaultListener},listenerOptions)}get doubleclicktime(){return TouchpadMap.get(this).doubleClickTime}set doubleclicktime(time){this.setAttribute("doubleclicktime",time)}get deadzoneradius(){return TouchpadMap.get(this).deadzoneRadius}set deadzoneradius(radius){this.setAttribute("deadzoneradius",radius)}get controlradius(){return TouchpadMap.get(this).controlRadius}set controlradius(radius){this.setAttribute("controlradius",radius)}getPointerData(pointerId){let pointerData=TouchpadMap.get(this).pointerMap.get(pointerId);if(!pointerData)return null;let pointerDataCopy={...pointerData},clickData=pointerData.clickData;return pointerDataCopy.clickData={0:{pressed:clickData[0].pressed,clicks:clickData[0].clicks},1:{pressed:clickData[1].pressed,clicks:clickData[1].clicks},2:{pressed:clickData[2].pressed,clicks:clickData[2].clicks},3:{pressed:clickData[3].pressed,clicks:clickData[3].clicks},4:{pressed:clickData[4].pressed,clicks:clickData[4].clicks}},pointerDataCopy}attributeChangedCallback(name,_,newValue){switch(name){case"doubleclicktime":{let time=Math.round(Number(newValue));if(time<100)time=100;TouchpadMap.get(this).doubleClickTime=time;break}case"deadzoneradius":{let radius=Math.round(Number(newValue));if(radius<1)radius=1;TouchpadMap.get(this).deadzoneRadius=radius;break}case"controlradius":{let radius=Math.round(Number(newValue));if(radius<1)radius=1;TouchpadMap.get(this).controlRadius=radius;break}}}connectedCallback(){let root=this.attachShadow({mode:"closed"});root.innerHTML=`${touchpad_default}`,TouchpadMap.get(this).pointerCaptureTarget=root.querySelector("#pointer-capture")}}customElements.define("touchpad-component",HTMLTouchpadElement);export{HTMLTouchpadElement};
