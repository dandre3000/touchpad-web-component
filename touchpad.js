var touchpad_default=`<style>
    :host {
        display: block;
        width: 300px;
        height: 150px;
        user-select: none;
    }
</style>
<slot></slot>`;var touchstartListener=function(event){for(let touch of event.changedTouches){let{identifier,screenX,screenY,clientX,clientY,radiusX,radiusY}=touch,width=radiusX*2,height=radiusY*2;this.touchpad.dispatchEvent(new PointerEvent("pointerenter",{bubbles:!0,pointerId:identifier,pointerType:"touch",button:0,buttons:1,screenX,screenY,clientX,clientY,width,height})),this.touchpad.dispatchEvent(new PointerEvent("pointerdown",{bubbles:!0,pointerId:identifier,pointerType:"touch",button:0,buttons:1,screenX,screenY,clientX,clientY,width,height}))}event.preventDefault()},touchmoveListener=function(event){for(let touch of event.changedTouches){let{identifier,screenX,screenY,clientX,clientY,radiusX,radiusY}=touch;this.touchpad.dispatchEvent(new PointerEvent("pointermove",{bubbles:!0,pointerId:identifier,pointerType:"touch",button:0,buttons:1,screenX,screenY,clientX,clientY,width:radiusX*2,height:radiusY*2}))}event.preventDefault()},touchendListener=function(event){for(let touch of event.changedTouches){let{identifier,screenX,screenY,clientX,clientY,radiusX,radiusY}=touch,width=radiusX*2,height=radiusY*2;this.touchpad.dispatchEvent(new PointerEvent("pointerup",{bubbles:!0,pointerId:identifier,pointerType:"touch",button:0,buttons:0,screenX,screenY,clientX,clientY,width,height})),this.touchpad.dispatchEvent(new PointerEvent("pointerleave",{bubbles:!0,pointerId:identifier,pointerType:"touch",button:0,buttons:0,screenX,screenY,clientX,clientY,width,height}))}},touchcancelListener=function(event){for(let touch of event.targetTouches){let{identifier,screenX,screenY,clientX,clientY,radiusX,radiusY}=touch,width=radiusX*2,height=radiusY*2;this.touchpad.dispatchEvent(new PointerEvent("pointerup",{bubbles:!0,pointerId:identifier,pointerType:"touch",button:0,buttons:0,screenX,screenY,clientX,clientY,width,height})),this.touchpad.dispatchEvent(new PointerEvent("pointerleave",{bubbles:!0,pointerId:identifier,pointerType:"touch",button:0,buttons:0,screenX,screenY,clientX,clientY,width,height}))}};var constrainDeadzone=(touchpadData,analogData)=>{let controlRadius=touchpadData.controlRadius,dx=analogData.controlX-analogData.deadzoneX,dy=analogData.controlY-analogData.deadzoneY,distance=Math.hypot(dx,dy);if(distance>controlRadius){let scale=(distance-controlRadius)/distance;analogData.deadzoneX+=dx*scale,analogData.deadzoneY+=dy*scale}},ponterDownListener=function(event){let touchpadData=this.touchpadData;if(touchpadData.analogMap.size<touchpadData.analogMax){touchpadData.touchpad.setPointerCapture(event.pointerId);let{x,y}=touchpadData.touchpad.getBoundingClientRect(),analogData={pointerId:event.pointerId,deadzoneX:event.clientX-x,deadzoneY:event.clientY-y,controlX:event.clientX-x,controlY:event.clientY-y,analogX:0,analogY:0};touchpadData.analogMap.set(event.pointerId,analogData),constrainDeadzone(touchpadData,analogData)}},ponterMoveListener=function(event){let touchpadData=this.touchpadData;if(touchpadData.analogMap.size===0)return;let analogData=touchpadData.analogMap.get(event.pointerId);if(!analogData)return;let{x,y}=touchpadData.touchpad.getBoundingClientRect(),{deadzoneRadius,controlRadius}=touchpadData,dx=analogData.controlX-event.clientX+x,dy=analogData.controlY-event.clientY+y,distance=Math.hypot(dx,dy);if(distance>controlRadius+deadzoneRadius){let scale=(distance-controlRadius-deadzoneRadius)/distance;analogData.controlX-=scale*dx,analogData.controlY-=scale*dy}if(dx=analogData.deadzoneX-event.clientX+x,dy=analogData.deadzoneY-event.clientY+y,distance=Math.hypot(dx,dy),distance>deadzoneRadius){let scale=(distance-deadzoneRadius)/distance;analogData.deadzoneX-=dx*scale,analogData.deadzoneY-=dy*scale,constrainDeadzone(touchpadData,analogData)}analogData.analogX=(analogData.deadzoneX-analogData.controlX)/controlRadius,analogData.analogY=(analogData.deadzoneY-analogData.controlY)/controlRadius,analogData.analogX=Math.round(analogData.analogX*100)/100,analogData.analogY=Math.round(analogData.analogY*100)/100},ponterUpListener=function(event){this.touchpadData.touchpad.releasePointerCapture(event.pointerId),this.touchpadData.analogMap.delete(event.pointerId)},defaultDeadzoneRadius=8,defaultControlRadius=64,TouchpadMap=new WeakMap;class HTMLTouchpadElement extends HTMLElement{static observedAttributes=["analogmax"];constructor(){super();let touchpadData={touchpad:this,deadzoneRadius:defaultDeadzoneRadius,controlRadius:defaultControlRadius,analogMax:0,analogMap:new Map};TouchpadMap.set(this,touchpadData),this.addEventListener("touchstart",{touchpad:this,handleEvent:touchstartListener},!0),this.addEventListener("touchmove",{touchpad:this,handleEvent:touchmoveListener},!0),this.addEventListener("touchend",{touchpad:this,handleEvent:touchendListener},!0),this.addEventListener("touchcancel",{touchpad:this,handleEvent:touchcancelListener},!0),this.addEventListener("pointerdown",{touchpadData,handleEvent:ponterDownListener},!0),this.addEventListener("pointermove",{touchpadData,handleEvent:ponterMoveListener},!0),this.addEventListener("pointerup",{touchpadData,handleEvent:ponterUpListener},!0)}get deadzoneRadius(){return TouchpadMap.get(this).deadzoneRadius}set deadzoneRadius(radius){if(radius=Math.round(Number(radius)),radius<1)radius=1;TouchpadMap.get(this).deadzoneRadius=radius}get controlRadius(){return TouchpadMap.get(this).controlRadius}set controlRadius(radius){if(radius=Math.round(Number(radius)),radius<1)radius=1;TouchpadMap.get(this).controlRadius=radius}getAnalogData(pointerId){return TouchpadMap.get(this).analogMap.get(pointerId)||null}attributeChangedCallback(name,oldValue,newValue){if(name==="analogmax"){let touchpadData=TouchpadMap.get(this),pointerIds=touchpadData.analogMap.keys();if(touchpadData.analogMax=Number(newValue),touchpadData.analogMax<1){touchpadData.analogMap.clear();return}let i=0;for(let id of pointerIds){if(i>touchpadData.analogMax)touchpadData.analogMap.delete(id);i++}}}connectedCallback(){let root=this.attachShadow({mode:"closed"});root.innerHTML=`${touchpad_default}`}}customElements.define("touchpad-component",HTMLTouchpadElement);export{HTMLTouchpadElement};
